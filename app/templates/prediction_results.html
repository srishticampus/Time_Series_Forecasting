{% extends 'base.html' %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="bg-white rounded-lg shadow-lg p-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">
                {{ company.name }} ({{ company.symbol }}) Prediction
            </h2>
            <a href="{% url 'dashboard' %}" class="text-primary hover:text-primary-dark">
                Back to Dashboard
            </a>
        </div>
        
        <div class="mb-8">
            <div id="timeSeriesChart" class="w-full h-96"></div>
        </div>
        
        <div class="bg-white rounded-lg shadow overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">
                    Detailed Predictions (Next {{ days }} Days)
                </h3>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Date
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Predicted Price
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Lower Bound
                            </th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Upper Bound
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for pred in predictions %}
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                {{ pred.forecast_date }}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                ${{ pred.predicted_price }}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                ${{ pred.lower_bound }}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                ${{ pred.upper_bound }}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
<script>
    const chartData = {{ chart_data|safe }};
    const chart = echarts.init(document.getElementById('timeSeriesChart'));
    
    const option = {
        animation: false,
        tooltip: {
            trigger: 'axis',
            backgroundColor: 'rgba(255, 255, 255, 0.9)',
            borderColor: '#eee',
            borderWidth: 1,
            textStyle: {
                color: '#1f2937',
            },
        },
        legend: {
            data: ['Predicted', 'Confidence Interval'],
            bottom: 0,
            textStyle: {
                color: '#1f2937',
            },
        },
        grid: {
            top: '3%',
            left: '3%',
            right: '4%',
            bottom: '10%',
            containLabel: true,
        },
        xAxis: {
            type: 'category',
            boundaryGap: false,
            data: chartData.dates,
            axisLabel: {
                color: '#1f2937',
            },
        },
        yAxis: {
            type: 'value',
            axisLabel: {
                color: '#1f2937',
                formatter: '${value}'
            },
        },
        series: [
            {
                name: 'Predicted',
                type: 'line',
                smooth: true,
                data: chartData.predicted,
                itemStyle: {
                    color: 'rgba(79, 70, 229, 1)',
                },
                areaStyle: {
                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                        {
                            offset: 0,
                            color: 'rgba(79, 70, 229, 0.1)',
                        },
                        {
                            offset: 1,
                            color: 'rgba(79, 70, 229, 0)',
                        },
                    ]),
                },
                showSymbol: false,
            },
            {
                name: 'Confidence Interval',
                type: 'line',
                data: chartData.upper,
                lineStyle: {
                    opacity: 0,
                },
                stack: 'confidence-band',
                symbol: 'none',
                areaStyle: {
                    color: 'rgba(199, 210, 254, 0.4)',
                },
                showSymbol: false,
            },
            {
                name: 'Confidence Interval',
                type: 'line',
                data: chartData.lower,
                lineStyle: {
                    opacity: 0,
                },
                areaStyle: {
                    color: 'rgba(199, 210, 254, 0.4)',
                },
                stack: 'confidence-band',
                symbol: 'none',
                showSymbol: false,
            },
        ],
    };
    
    chart.setOption(option);
    window.addEventListener('resize', function() {
        chart.resize();
    });
</script>
{% endblock %}